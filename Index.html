<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BNâ€™s SagovÃ¤rld</title>
  <meta name="description" content="BarnvÃ¤nlig AI som skapar sagor â€“ med snÃ¤llt minne, rÃ¶st, illustrationer och godnattmusik." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <header class="topbar">
    <img src="./assets/mascot.svg" alt="Maskot" class="logo">
    <h1>BNâ€™s SagovÃ¤rld</h1>
    <span id="modeBadge" class="badge">LÃ¤ge: okÃ¤nt</span>
    <div class="authbar">
      <span id="userEmail" class="muted">Inte inloggad</span>
      <button id="loginBtn" class="btn">Logga in</button>
      <button id="logoutBtn" class="btn secondary" hidden>Logga ut</button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>BerÃ¤tta din saga</h2>
      <p class="muted">SÃ¤g vad du vill att sagan ska handla om, eller skriv i rutan.</p>

      <div class="input-row">
        <textarea id="idea" rows="3" placeholder="Ex: En snÃ¤ll drake och en modig kanin som hittar en skatt i skogen."></textarea>
        <div class="mic-row">
          <button id="micBtn" class="btn secondary" aria-pressed="false">ğŸ¤ Prata</button>
          <span id="micStatus" class="muted">Mikrofon: av</span>
        </div>
      </div>

      <details class="mem">
        <summary>ğŸ§  Min hjÃ¤lte & snÃ¤llt minne (session)</summary>
        <div class="mem-grid">
          <label class="label" for="hero">Min hjÃ¤lte:</label>
          <input id="hero" type="text" placeholder="Ex: Lisa LejonhjÃ¤rta">
          <label class="label" for="fact1">Faktum 1:</label>
          <input id="fact1" type="text" placeholder="Ex: Ã„lskar morÃ¶tter">
          <label class="label" for="fact2">Faktum 2:</label>
          <input id="fact2" type="text" placeholder="Ex: Modig nÃ¤r vÃ¤nner behÃ¶ver hjÃ¤lp">
          <label class="label" for="fact3">Faktum 3:</label>
          <input id="fact3" type="text" placeholder="Ex: Har en rÃ¶d ryggsÃ¤ck">

          <div class="controls">
            <button id="saveMemBtn" class="btn">ğŸ’¾ Spara till session</button>
            <button id="clearMemBtn" class="btn secondary">ğŸ§¹ Rensa</button>
            <span id="memStatus" class="muted"></span>
          </div>
          <p class="muted tiny-note">Obs: Detta minne fÃ¶rsvinner nÃ¤r fliken stÃ¤ngs.</p>
        </div>
      </details>

      <div class="controls">
        <button id="generateBtn" class="btn primary">âœ¨ Generera saga</button>
        <span id="cooldown" class="muted"></span>
      </div>
      <p id="errorMsg" class="error" role="alert" hidden></p>
    </section>

    <section class="card">
      <h2>Din saga</h2>
      <div id="storyBox" class="story" aria-live="polite"></div>

      <div class="tts-controls">
        <label for="voiceSelect" class="label">RÃ¶st:</label>
        <select id="voiceSelect"></select>
        <label for="rate" class="label">Hastighet:</label>
        <input id="rate" type="range" min="0.7" max="1.3" step="0.05" value="1">
      </div>

      <div class="controls">
        <button id="speakBtn" class="btn">â–¶ï¸ Spela upp</button>
        <button id="stopBtn" class="btn secondary">â¹ Stoppa</button>
        <button id="saveProfileBtn" class="btn">â­ Spara hjÃ¤lte</button>
        <button id="makeTtsBtn" class="btn">ğŸ§ Skapa ljudfil</button>
        <a id="downloadTtsLink" class="btn secondary" href="#" download hidden>â¬‡ï¸ HÃ¤mta MP3</a>
        <button id="merchBtn" class="btn">ğŸ›ï¸ Skapa merch</button>
      </div>

      <p id="ttsMsg" class="muted" hidden></p>
    </section>

    <section class="card">
      <h2>â­ Favoritprofiler <span id="profileCount" class="badge"></span></h2>
      <p class="muted">Sparade hjÃ¤ltar med fakta och senaste saga (lokalt). Max 5 st pÃ¥ fÃ¶rsta nivÃ¥n.</p>

      <div class="fav-controls">
        <input id="profileName" type="text" placeholder="Profilnamn (t.ex. Lisa â€“ DrakvÃ¤n)">
        <button id="saveProfileNamedBtn" class="btn">ğŸ’« Spara som ny profil</button>
      </div>

      <div id="profilesEmpty" class="muted">Inga profiler sparade Ã¤n.</div>
      <ul id="profilesList" class="profiles"></ul>

      <div id="paywall" class="card" hidden>
        <h3>FortsÃ¤tt lÃ¤sa sagor</h3>
        <p class="muted" id="quotaMsg"></p>
        <div class="controls">
          <button id="buyTokensBtn" class="btn">KÃ¶p 20 sagor â€“ 49 kr</button>
          <button id="subscribeBtn" class="btn primary">Plus â€“ 89 kr/mÃ¥n</button>
        </div>
        <small class="muted">Swish via Stripe. Prenumeration fÃ¶rnyas automatiskt.</small>
      </div>
    </section>

    <section class="card">
      <h2>ğŸ¶ Godnattmusik</h2>
      <label for="ageRange" class="label">Barnets Ã¥lder:</label>
      <select id="ageRange">
        <option value="0-1">6â€“12 mÃ¥nader</option>
        <option value="2-4">2â€“4 Ã¥r</option>
        <option value="5-7">5â€“7 Ã¥r</option>
        <option value="8-10">8â€“10 Ã¥r</option>
      </select>
      <div class="controls">
        <button id="playSleepBtn" class="btn">â–¶ï¸ Spela musik</button>
        <button id="stopSleepBtn" class="btn secondary">â¹ Stoppa</button>
      </div>
      <audio id="sleepAudio" preload="auto"></audio>
      <p class="tiny-note muted">Tips: lÃ¤gg dina MP3 i R2 och fyll in lÃ¤nkarna i <code>sleepTracks</code> i <em>app.js</em>.</p>
    </section>

    <section class="card tiny">
      <details>
        <summary>ğŸ”’ Integritet & trygghet</summary>
        <ul class="muted">
          <li>SnÃ¤llt minne sparas i session (fÃ¶rsvinner nÃ¤r fliken stÃ¤ngs).</li>
          <li>Favoritprofiler sparas lokalt i webblÃ¤saren.</li>
          <li>Ingen reklam. Konto anvÃ¤nds fÃ¶r kvoter/betalning.</li>
          <li>TTS kÃ¶rs i din webblÃ¤sare eller pÃ¥ servern (om aktiverat).</li>
        </ul>
      </details>
    </section>
  </main>

  <footer class="foot">
    <span class="muted">Â© BNâ€™s SagovÃ¤rld â€“ barnversion, separat frÃ¥n vuxen-BN</span>
  </footer>

  <!-- Playful Loader -->
  <div id="loaderOverlay" aria-live="polite" aria-busy="true" style="display:none">
    <div class="loader-card">
      <div id="loaderAnim" class="anim dragon" aria-hidden="true">
        <span class="dragon-emoji">ğŸ‰ğŸš´â€â™‚ï¸</span>
      </div>
      <div id="loaderPizza" class="anim pizza" hidden>
        <div class="pizza-row" id="pizzaRow"></div>
      </div>
      <div id="loaderWheel" class="anim wheel" hidden><div class="wheel"></div></div>
      <div class="progress-wrap">
        <div class="progress-bar" id="loaderBar"></div>
        <div class="progress-text"><span id="loaderPct">0</span>%</div>
        <div id="loaderMsg" class="muted tiny-note">Magin startar straxâ€¦</div>
      </div>
      <div class="controls" style="margin-top:.5rem;">
        <button id="closeLoaderBtn" class="btn secondary" style="display:none">StÃ¤ng</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="./app.js"></script>
</body>
</html>

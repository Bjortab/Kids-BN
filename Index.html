<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BNâ€™s SagovÃ¤rld</title>
  <meta name="description" content="BarnvÃ¤nlig AI som skapar sagor â€“ med snÃ¤llt minne, rÃ¶st, illustrationer och godnattmusik." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <header class="topbar">
    <img src="./assets/mascot.svg" alt="Maskot" class="logo">
    <h1>BNâ€™s SagovÃ¤rld</h1>
    <span id="modeBadge" class="badge">LÃ¤ge: okÃ¤nt</span>

    <div class="authbar">
      <button id="parentBtn" class="btn gear" aria-haspopup="dialog" title="FÃ¶rÃ¤ldra-/konto-instÃ¤llningar">âš™ï¸</button>
      <span id="userEmail" class="muted">Inte inloggad</span>
      <button id="loginBtn" class="btn">Logga in</button>
      <button id="logoutBtn" class="btn secondary" hidden>Logga ut</button>
    </div>
  </header>

  <main class="container">
    <!-- Steg 1: idÃ©n -->
    <section class="card">
      <h2>BerÃ¤tta din saga</h2>
      <p class="muted">SÃ¤g vad sagan ska handla om, eller skriv i rutan.</p>

      <div class="input-row">
        <textarea id="idea" rows="3" placeholder="Ex: En snÃ¤ll drake som lÃ¤r sig flyga."></textarea>
        <div class="controls main-controls">
          <button id="micBtn" class="btn secondary" aria-pressed="false">ğŸ¤ Prata</button>
          <button id="generateBtn" class="btn primary">âœ¨ Skapa</button>
          <span id="cooldown" class="muted"></span>
        </div>
        <p id="errorMsg" class="error" role="alert" hidden></p>
      </div>

      <details class="mem advanced">
        <summary>ğŸ§  Min hjÃ¤lte & snÃ¤llt minne (session)</summary>
        <div class="mem-grid">
          <label class="label" for="hero">Min hjÃ¤lte:</label>
          <input id="hero" type="text" placeholder="Ex: Lisa LejonhjÃ¤rta">
          <label class="label" for="fact1">Faktum 1:</label>
          <input id="fact1" type="text" placeholder="Ex: Ã„lskar morÃ¶tter">
          <label class="label" for="fact2">Faktum 2:</label>
          <input id="fact2" type="text" placeholder="Ex: Modig nÃ¤r vÃ¤nner behÃ¶ver hjÃ¤lp">
          <label class="label" for="fact3">Faktum 3:</label>
          <input id="fact3" type="text" placeholder="Ex: Har en rÃ¶d ryggsÃ¤ck">
          <div class="controls">
            <button id="saveMemBtn" class="btn">ğŸ’¾ Spara till session</button>
            <button id="clearMemBtn" class="btn secondary">ğŸ§¹ Rensa</button>
            <span id="memStatus" class="muted"></span>
          </div>
          <p class="muted tiny-note">Obs: SnÃ¤llt minne fÃ¶rsvinner nÃ¤r fliken stÃ¤ngs.</p>
        </div>
      </details>
    </section>

    <!-- Steg 2: sagan -->
    <section class="card">
      <h2>Din saga</h2>
      <div id="storyBox" class="story" aria-live="polite"></div>

      <div class="tts-controls main-controls">
        <button id="speakBtn" class="btn">â–¶ï¸ Spela</button>
        <button id="stopBtn" class="btn secondary">â¹ Stoppa</button>

        <div class="advanced inline">
          <label for="voiceSelect" class="label">RÃ¶st:</label>
          <select id="voiceSelect"></select>
          <label for="rate" class="label">Hastighet:</label>
          <input id="rate" type="range" min="0.7" max="1.3" step="0.05" value="1">
          <button id="makeTtsBtn" class="btn">ğŸ§ Skapa MP3</button>
          <a id="downloadTtsLink" class="btn secondary" href="#" download hidden>â¬‡ï¸ HÃ¤mta</a>
        </div>
      </div>

      <div class="controls">
        <button id="saveProfileBtn" class="btn">â­ Spara hjÃ¤lte</button>
        <button id="merchBtn" class="btn advanced">ğŸ›ï¸ Skapa merch</button>
      </div>
      <p id="ttsMsg" class="muted" hidden></p>
    </section>

    <!-- Favoritprofiler (lÃ¥st pÃ¥ gratis, max 10 pÃ¥ Plus) -->
    <section class="card advanced">
      <h2>â­ Favoritprofiler <span id="profileCount" class="badge"></span></h2>
      <p class="muted">Sparade hjÃ¤ltar lÃ¥ses upp i Plus. Plus innehÃ¥ller upp till <b>10</b> hjÃ¤ltar.</p>

      <div class="fav-controls">
        <input id="profileName" type="text" placeholder="Profilnamn (t.ex. Lisa â€“ DrakvÃ¤n)">
        <button id="saveProfileNamedBtn" class="btn">ğŸ’« Spara som ny profil</button>
      </div>

      <div id="profilesEmpty" class="muted">Inga profiler sparade Ã¤n.</div>
      <ul id="profilesList" class="profiles"></ul>

      <div id="paywall" class="card" hidden>
        <h3>FortsÃ¤tt lÃ¤sa sagor</h3>
        <p class="muted" id="quotaMsg"></p>
        <div class="controls">
          <button id="buyTokensBtn" class="btn">KÃ¶p 20 sagor â€“ 49 kr</button>
          <button id="subscribeBtn" class="btn primary">Plus â€“ 89 kr/mÃ¥n</button>
        </div>
        <small class="muted">Swish via Stripe. Prenumeration fÃ¶rnyas automatiskt.</small>
      </div>
    </section>

    <!-- Godnattmusik -->
    <section class="card">
      <h2>ğŸ¶ Godnattmusik</h2>
      <label for="ageRange" class="label">Barnets Ã¥lder:</label>
      <select id="ageRange">
        <option value="0-1">6â€“12 mÃ¥nader</option>
        <option value="2-4">2â€“4 Ã¥r</option>
        <option value="5-7">5â€“7 Ã¥r</option>
        <option value="8-10">8â€“10 Ã¥r</option>
      </select>
      <div class="controls main-controls">
        <button id="playSleepBtn" class="btn">â–¶ï¸ Spela</button>
        <button id="stopSleepBtn" class="btn secondary">â¹ Stoppa</button>
      </div>
      <audio id="sleepAudio" preload="auto"></audio>
      <p class="tiny-note muted">Tips: lÃ¤gg dina MP3 i R2 och fyll in lÃ¤nkar i <code>sleepTracks</code> i <em>app.js</em>.</p>
    </section>
  </main>

  <footer class="foot">
    <span class="muted">Â© BNâ€™s SagovÃ¤rld â€“ barnversion, separat frÃ¥n vuxen-BN</span>
  </footer>

  <!-- FÃ¶rÃ¤ldra-/konto-modal -->
  <dialog id="parentModal" class="parent-modal">
    <form method="dialog">
      <h3>FÃ¶rÃ¤lder</h3>
      <p class="muted small">Konto, kÃ¶p & trygghet</p>
      <div class="grid2">
        <div>
          <h4>Konto</h4>
          <p id="pmUser" class="muted">Inte inloggad</p>
          <button id="pmLogin" class="btn">Logga in</button>
          <button id="pmLogout" class="btn secondary" type="button">Logga ut</button>
        </div>
        <div>
          <h4>KÃ¶p</h4>
          <button id="pmBuyTokens" class="btn">KÃ¶p 20 sagor â€“ 49 kr</button>
          <button id="pmSubscribe" class="btn primary">Plus â€“ 89 kr/mÃ¥n</button>
          <p id="pmEnt" class="muted tiny-note"></p>
        </div>
      </div>
      <div class="right"><button class="btn" id="pmClose">StÃ¤ng</button></div>
    </form>
  </dialog>

  <!-- Playful Loader -->
  <div id="loaderOverlay" aria-live="polite" aria-busy="true" style="display:none">
    <div class="loader-card">
      <div id="loaderAnim" class="anim dragon" aria-hidden="true">
        <span class="dragon-emoji">ğŸ‰ğŸš´â€â™‚ï¸</span>
      </div>
      <div id="loaderPizza" class="anim pizza" hidden>
        <div class="pizza-row" id="pizzaRow"></div>
      </div>
      <div id="loaderWheel" class="anim wheel" hidden><div class="wheel"></div></div>
      <div class="progress-wrap">
        <div class="progress-bar" id="loaderBar"></div>
        <div class="progress-text"><span id="loaderPct">0</span>%</div>
        <div id="loaderMsg" class="muted tiny-note">Magin startar straxâ€¦</div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="./app.js"></script>
</body>
</html>
